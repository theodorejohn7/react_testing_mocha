{"version":3,"sources":["src/chai-react-element.js"],"names":["chai","utils","opt","decompilerOptions","assign","registerMatcher","name","expectedValue","validateValue","arguments","length","candidates","filter","getActual","hasProp","elem","expectedValueMessage","assert","some","prop","prettyPrint","_obj","Assertion","text","actual","props","children","type","indexOf","assertion","assertee","flag","flatten","concat","getAssertee","obj","_reactInternalComponent","_currentElement","predicate","matcher","overwriteMethod","_super","apply","vdom","res","forEach","visitVDom","push","bind","visitor","undefined","Array","isArray","hasOwnProperty","_store","map","join"],"mappings":";;;;;;kBAKe,UAASA,IAAT,EAAeC,KAAf,EAAsBC,GAAtB,EAA2B;AACtC,QAAIA,OAAOA,IAAIC,iBAAf,EAAkC;AAC9B,yBAAEC,MAAF,2BAAkBF,IAAIC,iBAAtB;AACH;;AAEDE,oBAAgBL,IAAhB,EAAsBC,KAAtB,EAA6B,MAA7B,2BAAgD,UAASK,IAAT,EAAeC,aAAf,EAA8B;;AAE1E,YAAMC,gBAAgBC,UAAUC,MAAV,GAAmB,CAAzC;AACA,YAAMC,aAAa,iBAAEC,MAAF,CAASC,UAAU,IAAV,CAAT,EAA0B;AAAA,mBAAQC,QAAQC,IAAR,EAAcT,IAAd,CAAR;AAAA,SAA1B,CAAnB;;AAEA,YAAMU,uBAAuB,SAAvBA,oBAAuB;AAAA,mBAAMR,gCAA8BD,aAA9B,KAAN;AAAA,SAA7B;;AAEA,aAAKU,MAAL,CACIN,WAAWD,MAAX,KAAsB,CAACF,aAAD,IAAkB,iBAAEU,IAAF,CAAOP,UAAP,EAAmB;AAAA,mBAAQQ,KAAKJ,IAAL,EAAWT,IAAX,MAAqBC,aAA7B;AAAA,SAAnB,CAAxC,CADJ,gBAEgBa,YAAY,KAAKC,IAAjB,CAFhB,uCAEuEf,IAFvE,UAE+EU,sBAF/E,gBAGgBI,YAAY,KAAKC,IAAjB,CAHhB,2CAG2Ef,IAH3E,UAGmFU,sBAHnF;;AAMA,eAAO,IAAIhB,KAAKsB,SAAT,CAAmBX,UAAnB,CAAP;AACH,KAdD;;AAgBAN,oBAAgBL,IAAhB,EAAsBC,KAAtB,EAA6B,MAA7B,2BAAgD,UAASsB,IAAT,EAAe;AAC3D,YAAMC,SAASX,UAAU,IAAV,CAAf;AACA,YAAMF,aAAa,iBAAEC,MAAF,CAASY,MAAT,EAAiB;AAAA,mBAAQT,QAAQA,KAAKU,KAAb,KAAuBV,KAAKU,KAAL,CAAWC,QAAX,KAAwBH,IAAxB,IAAiCtB,MAAM0B,IAAN,CAAWZ,KAAKU,KAAL,CAAWC,QAAtB,KAAmC,OAAnC,IAA8C,CAACX,KAAKU,KAAL,CAAWC,QAAX,CAAoBE,OAApB,CAA4BL,IAA5B,CAAvG,CAAR;AAAA,SAAjB,CAAnB;AACA,aAAKN,MAAL,CACIN,WAAWD,MADf,gBAEgBU,YAAY,KAAKC,IAAjB,CAFhB,wBAEwDE,IAFxD,uBAGgBH,YAAY,KAAKC,IAAjB,CAHhB,4BAG4DE,IAH5D;AAKH,KARD;;AAUAlB,oBAAgBL,IAAhB,EAAsBC,KAAtB,EAA6B,eAA7B,2BAAyD,UAAS0B,IAAT,EAAe;;AAEpE,YAAMH,SAASX,UAAU,IAAV,CAAf;AACA,YAAMF,aAAa,iBAAEC,MAAF,CAASY,MAAT,EAAiB;AAAA,mBAAQT,QAAQA,KAAKY,IAAL,KAAcA,IAA9B;AAAA,SAAjB,CAAnB;AACA,aAAKV,MAAL,CACIN,WAAWD,MADf,gBAEgBU,YAAY,KAAKC,IAAjB,CAFhB,sCAEsEM,IAFtE,uBAGgBP,YAAY,KAAKC,IAAjB,CAHhB,0CAG0EM,IAH1E;;AAMA,eAAO,IAAI3B,KAAKsB,SAAT,CAAmBX,UAAnB,CAAP;AACH,KAXD;;AAaA,aAASE,SAAT,CAAmBgB,SAAnB,EAA8B;AAC1B,YAAMC,WAAWD,UAAUR,IAA3B;AACA,YAAIpB,MAAM8B,IAAN,CAAWF,SAAX,EAAsB,UAAtB,CAAJ,EAAuC;AACnC,mBAAOG,QAAQF,QAAR,CAAP;AACH,SAFD,MAEO;AACH,mBAAO,GAAGG,MAAH,CAAUH,QAAV,CAAP;AACH;AACJ;AAEJ,C;;AA1DD;;;;AACA;;;;AACA;;AACA;;;;;;AAyDA,SAASI,WAAT,CAAqBC,GAArB,EAA0B;AACtB,QAAIA,IAAIC,uBAAJ,IAA+BD,IAAIC,uBAAJ,CAA4BC,eAA/D,EAAgF;AAC5E,eAAOF,IAAIC,uBAAJ,CAA4BC,eAAnC;AACH,KAFD,MAEO;AACH,eAAOF,GAAP;AACH;AACJ;;AAED,SAAS9B,eAAT,CAAyBL,IAAzB,EAA+BC,KAA/B,EAAsCK,IAAtC,EAA4CgC,SAA5C,EAAuDC,OAAvD,EAAgE;AAC5DvC,SAAKsB,SAAL,CAAekB,eAAf,CAA+BlC,IAA/B,EAAqC,UAASmC,MAAT,EAAiB;AAClD,eAAO,YAAW;AACd,gBAAGH,UAAU,KAAKjB,IAAf,CAAH,EAAwB;AACpBpB,sBAAM8B,IAAN,CAAW,IAAX,EAAiB,QAAjB,EAA2BG,YAAY,KAAKb,IAAjB,CAA3B;AACA,uBAAOkB,QAAQG,KAAR,CAAc,IAAd,EAAoBjC,SAApB,CAAP;AACH,aAHD,MAGO;AACH,uBAAOgC,OAAOC,KAAP,CAAa,IAAb,EAAmBjC,SAAnB,CAAP;AACH;AACJ,SAPD;AAQH,KATD;AAUH;;AAED,SAASuB,OAAT,CAAiBW,IAAjB,EAAsB;AAClB,QAAIC,MAAM,EAAV;AACA,qBAAEC,OAAF,CAAU,GAAGZ,MAAH,CAAUU,IAAV,CAAV,EAA2B;AAAA,eAAMG,UAAUH,IAAV,EAAgBC,IAAIG,IAAJ,CAASC,IAAT,CAAcJ,GAAd,CAAhB,CAAN;AAAA,KAA3B;AACA,WAAOA,GAAP;AACH;;AAED,SAASE,SAAT,CAAmBH,IAAnB,EAAyBM,OAAzB,EAAkC;AAC9B,QAAGN,SAASO,SAAZ,EAAsB;AAAC;AAAO;AAC9B,QAAGC,MAAMC,OAAN,CAAcT,IAAd,CAAH,EAAuB;AACnBA,aAAKE,OAAL,CAAa,UAASF,IAAT,EAAc;AACvBG,sBAAUH,IAAV,EAAgBM,OAAhB;AACH,SAFD;AAGH,KAJD,MAIO;AACHA,gBAAQN,IAAR;AACA,YAAGA,QAAQA,KAAKlB,KAAhB,EAAsB;AAClBqB,sBAAUH,KAAKlB,KAAL,CAAWC,QAArB,EAA+BuB,OAA/B;AACH;AACJ;AACJ;;AAED,SAASnC,OAAT,CAAiBC,IAAjB,EAAuBT,IAAvB,EAA6B;AACzB,QAAI,CAACS,IAAL,EAAW,OAAO,KAAP;;AAEX,QAAIA,KAAKU,KAAT,EAAgB;AACZ,eAAOV,KAAKU,KAAL,CAAW4B,cAAX,CAA0B/C,IAA1B,CAAP;AACH,KAFD,MAEO,IAAIS,KAAKuC,MAAL,IAAevC,KAAKuC,MAAL,CAAY7B,KAA/B,EAAsC;AACzC,eAAOV,KAAKuC,MAAL,CAAY7B,KAAZ,CAAkB4B,cAAlB,CAAiC/C,IAAjC,CAAP;AACH;AACD,WAAO,KAAP;AACH;;AAED,SAASa,IAAT,CAAcJ,IAAd,EAAoBT,IAApB,EAA0B;AACtB,QAAI,CAACS,IAAL,EAAW;;AAEX,QAAIA,KAAKU,KAAT,EAAgB;AACZ,eAAOV,KAAKU,KAAL,CAAWnB,IAAX,CAAP;AACH,KAFD,MAEO,IAAIS,KAAKuC,MAAL,IAAevC,KAAKuC,MAAL,CAAY7B,KAA/B,EAAsC;AACzC,eAAOV,KAAKuC,MAAL,CAAY7B,KAAZ,CAAkBnB,IAAlB,CAAP;AACH,KAFM,MAEA;AACH;AACH;AACJ;;AAED,SAASc,WAAT,CAAqBuB,IAArB,EAA2B;AACvB,WAAO,GAAGV,MAAH,CAAUU,IAAV,EAAgBY,GAAhB,6BAA+BC,IAA/B,CAAoC,IAApC,CAAP;AACH","file":"src/chai-react-element.js","sourcesContent":["import _ from 'lodash';\r\nimport ReactDOM from 'react-dom';\r\nimport {decompile, options} from 'react-decompiler';\r\nimport predicate from './can-be-asserted';\r\n\r\nexport default function(chai, utils, opt) {\r\n    if (opt && opt.decompilerOptions) {\r\n        _.assign(options, opt.decompilerOptions);\r\n    }\r\n    \r\n    registerMatcher(chai, utils, 'prop', predicate, function(name, expectedValue) {\r\n\r\n        const validateValue = arguments.length > 1;\r\n        const candidates = _.filter(getActual(this), elem => hasProp(elem, name));\r\n\r\n        const expectedValueMessage = () => validateValue ? ` and value ${expectedValue}` : ``;\r\n\r\n        this.assert(\r\n            candidates.length && (!validateValue || _.some(candidates, elem => prop(elem, name) === expectedValue)),\r\n            `expected ${prettyPrint(this._obj)} to contain a prop with name '${name}'${expectedValueMessage()}`,\r\n            `expected ${prettyPrint(this._obj)} not to contain a prop with name '${name}'${expectedValueMessage()}`\r\n        );\r\n\r\n        return new chai.Assertion(candidates);\r\n    });\r\n\r\n    registerMatcher(chai, utils, 'text', predicate, function(text) {\r\n        const actual = getActual(this);\r\n        const candidates = _.filter(actual, elem => elem && elem.props && (elem.props.children === text || (utils.type(elem.props.children) == 'array' && ~elem.props.children.indexOf(text))));\r\n        this.assert(\r\n            candidates.length,\r\n            `expected ${prettyPrint(this._obj)} to have text '${text}'`,\r\n            `expected ${prettyPrint(this._obj)} not to have text '${text}'`\r\n        );\r\n    });\r\n\r\n    registerMatcher(chai, utils, 'elementOfType', predicate, function(type) {\r\n\r\n        const actual = getActual(this);\r\n        const candidates = _.filter(actual, elem => elem && elem.type === type);\r\n        this.assert(\r\n            candidates.length,\r\n            `expected ${prettyPrint(this._obj)} to have an element of type '${type}'`,\r\n            `expected ${prettyPrint(this._obj)} not to have an element of type '${type}'`\r\n        );\r\n\r\n        return new chai.Assertion(candidates);\r\n    });\r\n\r\n    function getActual(assertion) {\r\n        const assertee = assertion._obj;\r\n        if (utils.flag(assertion, 'contains')) {\r\n            return flatten(assertee);\r\n        } else {\r\n            return [].concat(assertee);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nfunction getAssertee(obj) {\r\n    if (obj._reactInternalComponent && obj._reactInternalComponent._currentElement) {\r\n        return obj._reactInternalComponent._currentElement;\r\n    } else {\r\n        return obj;\r\n    }\r\n}\r\n\r\nfunction registerMatcher(chai, utils, name, predicate, matcher) {\r\n    chai.Assertion.overwriteMethod(name, function(_super) {\r\n        return function() {\r\n            if(predicate(this._obj)){\r\n                utils.flag(this, 'object', getAssertee(this._obj));\r\n                return matcher.apply(this, arguments);\r\n            } else {\r\n                return _super.apply(this, arguments);\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction flatten(vdom){\r\n    var res = [];\r\n    _.forEach([].concat(vdom), () => visitVDom(vdom, res.push.bind(res)));\r\n    return res;\r\n}\r\n\r\nfunction visitVDom(vdom, visitor) {\r\n    if(vdom === undefined){return}\r\n    if(Array.isArray(vdom)){\r\n        vdom.forEach(function(vdom){\r\n            visitVDom(vdom, visitor);\r\n        });\r\n    } else {\r\n        visitor(vdom);\r\n        if(vdom && vdom.props){\r\n            visitVDom(vdom.props.children, visitor);\r\n        }\r\n    }\r\n}\r\n\r\nfunction hasProp(elem, name) {\r\n    if (!elem) return false;\r\n\r\n    if (elem.props) {\r\n        return elem.props.hasOwnProperty(name);\r\n    } else if (elem._store && elem._store.props) {\r\n        return elem._store.props.hasOwnProperty(name);\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction prop(elem, name) {\r\n    if (!elem) return;\r\n\r\n    if (elem.props) {\r\n        return elem.props[name];\r\n    } else if (elem._store && elem._store.props) {\r\n        return elem._store.props[name];\r\n    } else {\r\n        return;\r\n    }\r\n}\r\n\r\nfunction prettyPrint(vdom) {\r\n    return [].concat(vdom).map(decompile).join(', ');\r\n}\r\n"],"sourceRoot":"/source/"}